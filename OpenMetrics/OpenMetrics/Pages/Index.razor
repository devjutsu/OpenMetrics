@page "/"
@using MetaMask.Blazor
@inject MetaMaskService Meta
@inject IJSRuntime JS

<PageTitle>Index</PageTitle>

@code {
    bool Spinning = false;
    bool HasMetaMask = false;

    protected override async Task OnInitializedAsync()
    {
        await Authenticate();
    }

    async Task Authenticate()
    {
        Console.WriteLine("Authenticating...");
        Spinning = true;
        if (!await Meta.HasMetaMask())
        {
            Console.WriteLine("Has no MetaMask");
            HasMetaMask = false;
            StateHasChanged();
        }
        else
        {
            try
            {
                if (!await Meta.IsSiteConnected())
                    await Meta.ConnectMetaMask();
                var userId = await Meta.GetSelectedAddress();

                //await AppState.Login(this, user, newToken);


                //await GetSelectedNetwork();
            }
            catch (Exception ex)
            {
                //Toast.ShowError($"Auth failed. Please, check your wallet");
            }
        }
        Spinning = false;
    }
}